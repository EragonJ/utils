#!/usr/bin/perl
# mplayerd
use strict;
use App::Daemon qw(daemonize);

my @files = @ARGV or die 'Need files';
my $cmd = "mplayer -slave -input file=\$HOME/.mplayer/mplayerd.fifo";

unless(-p "$ENV{HOME}/.mplayer/mplayerd.fifo") {
  use POSIX;
  mkfifo("$ENV{HOME}/.mplayer/mplayerd.fifo", 0666) or die $!;
}

print "Daemonizing. PID=$$\n";
daemonize();
system("$cmd \"$_\"") for @files;

